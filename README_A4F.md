# A4F Integration Guide

This project integrates A4F (AI for Interviews) for dynamic question generation in mock interviews.

## üöÄ Setup

### 1. Environment Variables

Create a `.env` file in the root directory with the following variables:

```env
A4F_BASE_URL=https://api.a4f.co/v1
A4F_API_KEY=your-rotated-secret-key
A4F_MODEL=provider-5/gpt-4o-mini
PORT=3001
VITE_API_BASE_URL=http://localhost:3001
```

**Important:** Never commit your `.env` file to version control. The `.env.example` file is provided as a template.

### 2. Install Dependencies

```bash
npm install
```

This will install:
- `express` - Backend server
- `cors` - CORS middleware
- `dotenv` - Environment variable management

### 3. Start the Development Servers

You have two options:

**Option A: Run separately (recommended for development)**

Terminal 1 - Frontend:
```bash
npm run dev
```

Terminal 2 - Backend:
```bash
npm run server
```

**Option B: Run together (requires `concurrently`)**

```bash
npm install -D concurrently
npm run dev:full
```

## üì° API Endpoints

### POST `/api/generate-questions-a4f`

Generates interview questions using A4F API.

**Request Body:**
```json
{
  "roles": ["Web Development", "Full Stack"],
  "level": "medium",
  "interviewType": "technical",
  "questionTypes": ["mcq", "qa", "code"],
  "durationMin": 30,
  "inputMode": "text-voice",
  "resumeText": "Optional resume text...",
  "usedIds": ["question-id-1", "question-id-2"]
}
```

**Response:**
```json
{
  "questions": [
    {
      "id": "uuid",
      "type": "mcq",
      "prompt": "Question text...",
      "options": ["Option 1", "Option 2", "Option 3", "Option 4"],
      "correctAnswer": 0,
      "skill": "Web Development",
      "difficulty": "medium",
      "tags": ["react", "javascript"],
      "estimatedTime": 120,
      "rubricTarget": "accuracy"
    }
  ],
  "source": "a4f",
  "count": 10
}
```

### GET `/health`

Health check endpoint for the backend server.

## üîß How It Works

1. **User Configuration**: When a user clicks "Start Interview" on the `StartInterviewPage`, their selections (roles, level, question types, duration, etc.) are stored.

2. **Question Generation**: The `InterviewRunnerPage` calls the A4F API via the backend server to generate personalized questions based on:
   - Selected roles
   - Difficulty level
   - Interview type (technical/behavioural/mix)
   - Question types (MCQ, Q&A, Code, Debugging)
   - Duration
   - Resume text (if provided)
   - Previously used question IDs (to avoid repeats)

3. **Fallback Mechanism**: If A4F API fails, the system falls back to local question generation to ensure the interview can still proceed.

4. **Question Storage**: Generated questions are stored in the interview session, and completed question IDs are saved to prevent repeats in future sessions.

## üõ°Ô∏è Security

- **API Key Protection**: The A4F API key is stored server-side only and never exposed to the client.
- **Environment Variables**: All sensitive configuration is managed through environment variables.
- **CORS**: The backend server includes CORS middleware to control access.

## üìù Question Format

Questions generated by A4F follow this structure:

```typescript
interface Question {
  id: string;                    // Unique identifier
  type: 'mcq' | 'qa' | 'code' | 'debugging';
  prompt: string;                // Question text
  options?: string[];            // For MCQ questions
  correctAnswer?: number;         // For MCQ (index) or Q&A (string)
  hint?: string;                 // Optional hint
  language?: string;              // For code questions
  codeSnippet?: string;           // For code/debugging questions
  skill: string;                 // Role/skill area
  difficulty: 'easy' | 'medium' | 'hard';
  tags: string[];                // Skill tags
  estimatedTime: number;          // Time in seconds
  rubricTarget: string;          // Evaluation focus
  tests?: {                       // For code questions
    visible?: Array<{ input, expected, description }>;
    hidden?: Array<{ input, expected }>;
  };
}
```

## üîÑ Integration Flow

```
User ‚Üí StartInterviewPage ‚Üí InterviewRunnerPage
                              ‚Üì
                    generateQuestions()
                              ‚Üì
                    generateQuestionsA4F() [A4F Service]
                              ‚Üì
                    POST /api/generate-questions-a4f [Backend]
                              ‚Üì
                    A4F API (https://api.a4f.co/v1)
                              ‚Üì
                    Questions returned ‚Üí Interview starts
```

## üêõ Troubleshooting

### Backend server won't start
- Check that `PORT` is not already in use
- Verify `.env` file exists and contains required variables
- Ensure `A4F_API_KEY` is set correctly

### A4F API errors
- Verify API key is valid and not expired
- Check `A4F_BASE_URL` is correct
- Review backend server logs for detailed error messages
- System will automatically fall back to local generation

### Questions not generating
- Check browser console for errors
- Verify backend server is running
- Check network tab for API call status
- Review `VITE_API_BASE_URL` matches backend port

## üìö Additional Resources

- [A4F Documentation](https://docs.a4f.co)
- [Express.js Documentation](https://expressjs.com)
- [Vite Environment Variables](https://vitejs.dev/guide/env-and-mode.html)

